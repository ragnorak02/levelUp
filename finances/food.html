<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Food Tracking</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#131a22; --ink:#e8eef6; --muted:#9fb0c7;
      --accent:#4CAF50; --accent2:#2dd4bf;
      --ring:#2a3543; --good:#22c55e; --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(1200px 800px at 50% -200px, rgba(76,175,80,.20), transparent 55%),
        radial-gradient(900px 700px at 10% 0%, rgba(45,212,191,.12), transparent 60%),
        var(--bg);
      color:var(--ink);
      min-height:100vh;
    }
    a{color:inherit; text-decoration:none}

    /* --- TOPBAR (copied from index.html) --- */
    .topbar{
      position:sticky; top:0; z-index:20;
      background: linear-gradient(180deg, rgba(11,15,20,.92), rgba(11,15,20,.72));
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(42,53,67,.55);
    }
    .topbar-inner{
      max-width:1120px; margin:0 auto;
      padding:6px 10px;
      display:flex; align-items:center; gap:10px;
      flex-wrap:nowrap;
    }
    .brand-group{
      display:flex; align-items:center; gap:8px;
      flex:0 0 auto;
    }
    .brand{
      display:flex; align-items:center; gap:8px;
      font-weight:900;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(42,53,67,.75);
      background: rgba(19,26,34,.55);
      box-shadow: var(--shadow);
      flex:0 0 auto;
      white-space:nowrap;
    }
    .brand-group .brand.active{
      color:#0b0f14;
      background: linear-gradient(135deg, rgba(76,175,80,1), rgba(45,212,191,1));
      border-color: transparent;
    }
    .nav{
      margin-left:auto;
      display:flex; gap:8px;
      align-items:center;
      flex:1 1 auto;
      overflow-x:auto;
      overflow-y:hidden;
      -webkit-overflow-scrolling: touch;
      white-space:nowrap;
      padding-bottom:2px;
    }
    .nav::-webkit-scrollbar{height:6px}
    .nav::-webkit-scrollbar-thumb{background:rgba(42,53,67,.6); border-radius:999px}
    .pill{
      flex:0 0 auto;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(42,53,67,.75);
      background: rgba(19,26,34,.55);
      color:var(--muted);
      font-weight:800;
      font-size:13px;
    }
    .pill.active{
      color:#0b0f14;
      background: linear-gradient(135deg, rgba(76,175,80,1), rgba(45,212,191,1));
      border-color: transparent;
    }

    /* --- page layout --- */
    .wrap{
      max-width:1120px; margin:0 auto; padding:16px;
      display:flex; flex-direction:column; gap:16px;
    }
    .card{
      background: rgba(19,26,34,.72);
      border:1px solid rgba(42,53,67,.70);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .card h3{ margin:0 0 12px; font-size:14px; color:var(--muted); font-weight:900; letter-spacing:.2px; }

    .stats-grid {
      display:grid; gap:10px;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }
    .stat-card{
      padding:12px 14px;
      background: rgba(11,15,20,.35);
      border:1px solid rgba(42,53,67,.55);
      border-radius: 14px;
      text-align:center;
    }
    .stat-value{font-size:24px; font-weight:900; color:var(--good); line-height:1.1}
    .stat-label{font-size:12px; color:var(--muted); margin-top:4px; font-weight:800}

    .food-categories{
      display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:12px;
    }
    .food-cat{
      background: rgba(11,15,20,.35);
      border:1px solid rgba(42,53,67,.55);
      border-radius: 14px;
      padding:14px;
      cursor:pointer;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
    }
    .food-cat:hover{ border-color: rgba(76,175,80,.65); background: rgba(76,175,80,.06); transform: translateY(-1px); }
    .food-cat-icon{ font-size: 26px; margin-bottom: 8px; }
    .food-cat-name{ font-weight: 900; }
    .food-cat-amount{ font-size: 18px; font-weight: 950; color: var(--good); margin-top: 2px; }
    .food-cat-items{ font-size: 12px; color: var(--muted); font-weight: 800; margin-top: 2px; }

    .chart-container{ position:relative; height:250px; margin: 10px 0 0; }
    canvas{ max-width:100%; max-height:100%; width:100%; }
  </style>
</head>
<body>
  <!-- TOPBAR (standardized) -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand-group" role="navigation" aria-label="Home and Finances">
        <a class="brand brand-home" href="https://ragnorak02.github.io/levelUp/main.html" title="Back to LevelUp Home">üè† <span>Home</span></a>
        <a class="brand brand-fin active" href="index.html" title="Finances dashboard">üí∞</a>
      </div>
      <div class="nav">
        <a class="pill" href="index.html">Finances</a>
        <a class="pill active" href="food.html">Food</a>
        <a class="pill" href="search.html">Search</a>
        <a class="pill" href="receipts.html">Receipts</a>
      </div>
    </div>
  </div>

  <main class="wrap">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="foodTotal">$0</div>
        <div class="stat-label">Food Spending</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="foodMonth">$0</div>
        <div class="stat-label">This Month</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="foodWeek">$0</div>
        <div class="stat-label">This Week</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="avgFood">$0</div>
        <div class="stat-label">Avg per Trip</div>
      </div>
    </div>

    <div class="card">
      <h3>üçé Food Categories</h3>
      <div class="food-categories" id="foodCategories"></div>
    </div>

    <div class="card">
      <h3>üìä Category Breakdown</h3>
      <div class="chart-container">
        <canvas id="foodChart"></canvas>
      </div>
    </div>
  </main>

  <script>
    const FOOD_CATEGORIES = {
      'Produce': 'ü•¨',
      'Dairy': 'ü•õ',
      'Meat': 'ü•©',
      'Meat/Fish': 'ü•©',
      'Grains': 'üåæ',
      'Snacks': 'üç™',
      'Drinks': 'ü•§',
      'Cafe': '‚òïÔ∏è',
      'Pantry': 'ü•´',
      'Frozen': 'üßä',
      'Bakery': 'üçû'
    };

    document.addEventListener('DOMContentLoaded', () => {
      loadFoodData();
    });

    function loadFoodData() {
      const receipts = getReceipts();
      const foodData = analyzeFoodSpending(receipts);

      updateFoodStats(foodData);
      renderFoodCategories(foodData.categories);
      drawFoodChart(foodData.categories);
    }

    function getReceipts() {
      try {
        return JSON.parse(localStorage.getItem('finances:receipts') || '[]');
      } catch (e) {
        return [];
      }
    }

    function analyzeFoodSpending(receipts) {
      const categories = {};
      let totalFood = 0;
      let monthFood = 0;
      let weekFood = 0;
      let foodTrips = 0;

      const now = new Date();
      const thisMonth = now.getMonth();
      const thisYear = now.getFullYear();
      const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);

      receipts.forEach(receipt => {
        const date = new Date(receipt.date);
        let hasFoodItems = false;

        (receipt.items || []).forEach(item => {
          if (Object.keys(FOOD_CATEGORIES).includes(item.category)) {
            const price = parseFloat(item.price) || 0;
            hasFoodItems = true;

            if (!categories[item.category]) categories[item.category] = { total: 0, count: 0 };

            categories[item.category].total += price;
            categories[item.category].count++;
            totalFood += price;

            if (date.getMonth() === thisMonth && date.getFullYear() === thisYear) monthFood += price;
            if (date >= weekAgo) weekFood += price;
          }
        });

        if (hasFoodItems) foodTrips++;
      });

      return {
        total: totalFood,
        month: monthFood,
        week: weekFood,
        avgPerTrip: foodTrips > 0 ? totalFood / foodTrips : 0,
        categories
      };
    }

    function updateFoodStats(data) {
      document.getElementById('foodTotal').textContent = '$' + data.total.toFixed(2);
      document.getElementById('foodMonth').textContent = '$' + data.month.toFixed(2);
      document.getElementById('foodWeek').textContent = '$' + data.week.toFixed(2);
      document.getElementById('avgFood').textContent = '$' + data.avgPerTrip.toFixed(2);
    }

    function renderFoodCategories(categories) {
      const container = document.getElementById('foodCategories');
      container.innerHTML = '';

      Object.entries(categories)
        .sort((a, b) => b[1].total - a[1].total)
        .forEach(([name, data]) => {
          const div = document.createElement('div');
          div.className = 'food-cat';
          div.onclick = () => viewCategory(name);

          div.innerHTML = `
            <div class="food-cat-icon">${FOOD_CATEGORIES[name] || 'üì¶'}</div>
            <div class="food-cat-name">${name}</div>
            <div class="food-cat-amount">$${data.total.toFixed(2)}</div>
            <div class="food-cat-items">${data.count} items</div>
          `;

          container.appendChild(div);
        });
    }

    function drawFoodChart(categories) {
      const canvas = document.getElementById('foodChart');
      const ctx = canvas.getContext('2d');

      const size = Math.min(canvas.parentElement.clientWidth, 300);
      canvas.width = size;
      canvas.height = size;

      const centerX = size / 2;
      const centerY = size / 2;
      const radius = size / 3;
      const innerRadius = radius * 0.6;

      ctx.clearRect(0, 0, size, size);

      const total = Object.values(categories).reduce((sum, cat) => sum + cat.total, 0);
      if (total === 0) return;

      const colors = ['#4CAF50', '#8b5cf6', '#f59e0b', '#ef4444', '#3b82f6', '#ec4899', '#14b8a6', '#94a3b8'];
      const CATEGORY_COLORS = {'Groceries': '#4CAF50', 'Cafe': '#f59e0b', 'Restaurant': '#ef4444' };

      let currentAngle = -Math.PI / 2;

      Object.entries(categories).forEach(([name, cat], i) => {
        const sliceAngle = (cat.total / total) * 2 * Math.PI;

        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.arc(centerX, centerY, innerRadius, currentAngle + sliceAngle, currentAngle, true);
        ctx.closePath();

        ctx.fillStyle = CATEGORY_COLORS[name] || colors[i % colors.length];
        ctx.fill();

        currentAngle += sliceAngle;
      });

      ctx.fillStyle = '#e8eef6';
      ctx.font = '900 22px system-ui';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('$' + total.toFixed(0), centerX, centerY);

      ctx.font = '800 12px system-ui';
      ctx.fillStyle = '#9fb0c7';
      ctx.fillText('Food Total', centerX, centerY + 22);
    }

    function viewCategory(category) {
      location.href = `search.html?category=${encodeURIComponent(category)}`;
    }
  </script>
</body>
</html>
